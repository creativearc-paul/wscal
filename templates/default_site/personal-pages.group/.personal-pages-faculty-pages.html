{exp:structure_entries parent="{embed:parent_id}" depth="3"}

    {if depth == 1} {!-- Top Level --}
            
        
        <li class="{if current_parent} current{/if}{if current_page} active{/if}">
        
            <a href="{page_uri}">{title}.</a>
            
            {if children_total == 0}
            	{!-- No Children - so close markup --}
                </li>
            {/if}
            
            
    {if:else} {!-- Children (not top level) --}

        
        {if sibling_count == 1} 
            {!-- First child - so open markup --}
            <ul class="level{depth}">
        {/if}
        
        <li class="{if current_parent} current{/if}{if current_page} active{/if}">
        
        <a href="{page_uri}">{title}</a>
        
        {close_markup}
        
            {if total_children == 0 || depth == restricted_depth}
                </li>
            {/if}
            
            {if last_sibling && sibling_count == sibling_total}
                    </ul>
                </li>
            {/if}
            
        {/close_markup}
        
        
    {/if}
    
{/exp:structure_entries}